# ğŸ° Promotion Rule Engine Microservice

A configurable and testable rule engine designed for a casino gaming platform to allocate personalized promotions to players based on dynamic user attributes.

---

#### ğŸ”¨ Implemented Features:
- âœ… **Rule Configuration**: YAML-based engine, easy to update without code changes
- âœ… **Multiple Rule Attributes**: Priority, A/B buckets, time windows, and condition operators
- âœ… **Multiple Promotion Types**: Bonus credits, cashback, multipliers, and more
- âœ… **Batch Evaluation Engine**: CLI script to simulate thousands of users
- âœ… **API Interface**: Flask-based `/evaluate` endpoint for real-time promotion allocation
- âœ… **Testing**: 16 fully passing unit tests using `pytest`


## ğŸ“ Project Structure

Promotion_rule_engine_microservice/
â”‚
â”œâ”€â”€ app.py # Flask API layer
â”œâ”€â”€ promotion_evaluator.py # Main promotion interface
â”œâ”€â”€ metrices.py
â”œâ”€â”€ yaml_loader.py
â”œâ”€â”€ rules
â”‚  â””â”€â”€ rules.yaml # Promotion rules config
â”œâ”€â”€ rule_engine/
â”‚ â””â”€â”€ matcher.py # Core rule evaluation logic
â”‚ â””â”€â”€ loader.py
â”‚ â””â”€â”€ models.py
â”‚
â”œâ”€â”€ scripts/
â”‚ â”œâ”€â”€ generate_users.py # Random user generator
â”‚ â”œâ”€â”€ run_evaluations.py # Evaluate users in batch
â”‚
â”œâ”€â”€ data/
â”‚ â””â”€â”€ evaluation_results.json # Evaluation outputs
â”œâ”€â”€ user/
â”‚ â””â”€â”€ generated_user.json # random users generated by faker
â”‚
â”œâ”€â”€ tests/
â”‚ â””â”€â”€ test_engine.py # Pytest unit tests
â”‚
â””â”€â”€ requirements.txt # Python dependencies

## âš™ï¸ Installation

```bash
git clone https://github.com/vihabhat/Promotion_rule_engine_microservice.git
cd Promotion_rule_engine_microservice
pip install -r requirements.txt

Rules Configurations are stored in rules.yaml file

## âš™ï¸ Runings

Running tests: 
pytest
There are 16 test cases all needs to be cleared.

Command to generate bulk users and save to JSON:
python -m scripts.generate_users

This script Simulates a list of user profiles with realistic values (like level, total_spent, spend_tier, etc.)

Saves the output to:
data/sample_users.json

Simulating Bulk Users:
python -m scripts.run_evaluations
this outputs the results to data/evaluation_results.json

Running the API:
python app.py

Test using powershell:
$headers = @{ "Content-Type" = "application/json" }
$body = @{
  user_profile = @{
    player_id = "test_user_001"
    level = 20
    total_spent = 12000
    current_balance = 1500
    country = "US"
    spend_tier = "vip"
    days_since_last_purchase = 10
    registration_date = "2022-05-12"
  }
}
$bodyJson = $body | ConvertTo-Json -Depth 5
Invoke-RestMethod -Uri http://localhost:5000/evaluate -Method POST -Headers $headers -Body $bodyJson

API Response :
{
  "player_id": "test_user_001",
  "matched_promotion": [
    {
      "id": "vip_bonus",
      "type": "bonus_credits",
      "amount": 200.0
    },
    {
      "id": "us_bonus",
      "type": "bonus_credits",
      "amount": 50.0
    }
  ]
}

ğŸ§  Designed For

1. Casino operators to run marketing experiments (A/B test promotions)
2. Scalable integration with player segmentation and user retention logic
3. Extendable rule system without code changes (just update YAML)


ğŸ‘©â€ğŸ’» Author
Viha Suhas Bhat
Built as part of an internship assignment with focus on backend microservice design, config-driven systems, and rule-based automation.