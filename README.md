# 🎰 Promotion Rule Engine Microservice

A configurable and testable rule engine designed for a casino gaming platform to allocate personalized promotions to players based on dynamic user attributes.

---

#### 🔨 Implemented Features:
- ✅ **Rule Configuration**: YAML-based engine, easy to update without code changes
- ✅ **Multiple Rule Attributes**: Priority, A/B buckets, time windows, and condition operators
- ✅ **Multiple Promotion Types**: Bonus credits, cashback, multipliers, and more
- ✅ **Batch Evaluation Engine**: CLI script to simulate thousands of users
- ✅ **API Interface**: Flask-based `/evaluate` endpoint for real-time promotion allocation
- ✅ **Testing**: 16 fully passing unit tests using `pytest`


## 📁 Project Structure

Promotion_rule_engine_microservice/
│
├── app.py # Flask API layer
├── promotion_evaluator.py # Main promotion interface
├── metrices.py
├── yaml_loader.py
├── rules
│  └── rules.yaml # Promotion rules config
├── rule_engine/
│ └── matcher.py # Core rule evaluation logic
│ └── loader.py
│ └── models.py
│
├── scripts/
│ ├── generate_users.py # Random user generator
│ ├── run_evaluations.py # Evaluate users in batch
│
├── data/
│ └── evaluation_results.json # Evaluation outputs
├── user/
│ └── generated_user.json # random users generated by faker
│
├── tests/
│ └── test_engine.py # Pytest unit tests
│
└── requirements.txt # Python dependencies

## ⚙️ Installation

```bash
git clone https://github.com/vihabhat/Promotion_rule_engine_microservice.git
cd Promotion_rule_engine_microservice
pip install -r requirements.txt

Rules Configurations are stored in rules.yaml file

## ⚙️ Runings

Running tests: 
pytest
There are 16 test cases all needs to be cleared.

Command to generate bulk users and save to JSON:
python -m scripts.generate_users

This script Simulates a list of user profiles with realistic values (like level, total_spent, spend_tier, etc.)

Saves the output to:
data/sample_users.json

Simulating Bulk Users:
python -m scripts.run_evaluations
this outputs the results to data/evaluation_results.json

Running the API:
python app.py

Test using powershell:
$headers = @{ "Content-Type" = "application/json" }
$body = @{
  user_profile = @{
    player_id = "test_user_001"
    level = 20
    total_spent = 12000
    current_balance = 1500
    country = "US"
    spend_tier = "vip"
    days_since_last_purchase = 10
    registration_date = "2022-05-12"
  }
}
$bodyJson = $body | ConvertTo-Json -Depth 5
Invoke-RestMethod -Uri http://localhost:5000/evaluate -Method POST -Headers $headers -Body $bodyJson

API Response :
{
  "player_id": "test_user_001",
  "matched_promotion": [
    {
      "id": "vip_bonus",
      "type": "bonus_credits",
      "amount": 200.0
    },
    {
      "id": "us_bonus",
      "type": "bonus_credits",
      "amount": 50.0
    }
  ]
}

🧠 Designed For

1. Casino operators to run marketing experiments (A/B test promotions)
2. Scalable integration with player segmentation and user retention logic
3. Extendable rule system without code changes (just update YAML)


👩‍💻 Author
Viha Suhas Bhat
Built as part of an internship assignment with focus on backend microservice design, config-driven systems, and rule-based automation.